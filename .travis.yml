sudo: required
services:
- docker
language: java
jdk:
- oraclejdk8
env:
  matrix:
  - TEST_DIR=client
  - TEST_DIR=server
  global:
  - REGISTRY_USERNAME=gionn
  - BLOB_IDENTITY=cloudesire-deployer
  - DOCKER_COMPOSE_VERSION=1.5.2
  - CI_DEPLOY_GPG_KEYID=2B9E8D20
  - secure: lYNsDfdJKJ1+uoWZhOMqyDhqycdcWujt8VsJXcx27s60HNbjTvnZKJ5gWJImU2tDTGN49Ge25/G/M9tDb7vOXGKgBH3KSwFzWMUrx+7sL7L+zZq25bPAxrrigC7gofuci9ZUx2n+0y0JOQTnD9QHP2B9FLcxxTJOfMg2cyygO7MB++XjjdjwjNZvvhJQQd6IvdL1VclfSWjvkt7zZDEQ/Z73XCY7o0T8M4H8m2a9p5N5C0cEWt0MPUOraTIX3OuOYyiLt0X8U204wjEkfMW28kZvnD0GmU1RSB1MmLf/CjrtdEJQEFaRRaQOlH+Pd8XeOYIf9dLHB0fmQcsuvzl9EdPLQTc972Xafy8TebzTSPqRiREZT4NZSWLa/v0sqQcmgLcl9fsSQrsef++Ovjint8NRYagjyTn2ZMPFN7hc8mNqtYr0rdNzP4aV1iXF5nFeM/7kONaR/DO3k61zGETbUYLxQfW0fuGzfCdBVFLyeUEp2HnbnSS0Z4nziNPK6EGKlVZkkTIYiftBk1f+WSg7AMAJ88fQCA4J8BfLgvY8ltu2SCStfFlmESTrJdB217RUZijqO1Sc1vrcj6cAj8Y7tf/9g7gn2NpbCOODwFLkRk4LwW5+5j95wWMn+zZlNkbL+D9OxzN805Pxs7EMizrEoK8FY6dZJOqubJHMGMbDSFI=
  - secure: GjEZzKw05UxIc/3+ykBWJdlbVB8zK7RZT0PI2xd4+ecyodiybobBf2ILLS5ao+Kn71wl1VgB7xz0EMh4zoJYRiehdN+2yKcoY1KCgvvTSYTHEjvlgPGjmB1VMEcqZZmd5NFE2rHeJpSHqS3tE7dJeWlSOHUeeKJT3RTaIUiGFpA3HnL1mPf8T2hir7ys+LHUsM/0eF8ry18fvYKqs5x0gag8pLrZaIU+AbGVgLtAsLJkjAettzjes/ivfkLeWNj6dlcGS4AuSb5uNbpBa8vFzryQhugXohni8iHyPLNRe2KRpbHZuC39FPUZdPwZ86JaHNa4zoyjLPm8+9fcV4LEVU6CPTeBl/TvL4oF51BnCus+F6oP/KHt2NncbOJR2NeC4nzxpJj9euPiPx6H8qDqsZLjZyaB52R755RRjwjbMCSGKbfQZmXHi+P2g+uWYISVhTkjVJ3Wk1UPRqg8BZbwUHSfk+ev3yjHcnv2Gdvk428Y7mw7RaQdVSJaODds1daqdfBMsn+3nBivLTG4iM04HLfThFQvbZ+FNawz8W8A1HWNTfReYIPm7bltDV8vi7iPW4uYafcx+Dp5A78kzV5GYTk/avWBXKTo5HyBZ7vW1cfjLe+Dy/SGdwf+DhOTGgo2Z3dCwxt12+y4zlV1N4u66H2uJPqVggZtJQB/QhfoCek=
  - secure: kyZpJgwyqRpRh3c6IUxxBzukHZSdcisLNNBDbLYwUJDnu215J58nXtgIQHTD6CG1yar3KmRGGh2cDNpFeDrZVEdLUKMC8XHXSlVSP78AeD6MJHBRzkDMRdWemk+uW836YbCRl9LQw5L1MTwq91JpyZv1MU7RGgMs8Yg4mr0WId32Y3yW4SsTUh5zHxTJ9pQfAQQa/4azAjtugIfZ42w62lwTK+oO/GulcJCbHrHp/RDEqS6qtkKNXFHSo5woKj5qVPTJwA8+dwhSOXJJSTK56xDFh+yOEeXaZKjwMYHvOxrPZbuCZeAPzlQcrWH72W5dAwHBBKjvreNsrsZSgkDWnakPe6ZMkPYk0aqqp89WBnrv5ohe3w5a8kUFI6qjwsoOnvljy1ONA5A0KIALybYsoM4psAgEPcinOSl56XsfO1TrzqGXWGN3j5opgUV4K4EMbuAtgBOp5cRo6Y+btRoWbXWvOvG+6Ti3y5FPBUKP/Dh7PgcU5FjfxDaUyNaL2b7TFI63jhDUrZyOV5GowfXEQXSzcw1L2WVz7v74H4m1sZ1juIbnn5rdmR8p88KxTcQISm2wBVVaWHH72SUJ22Qw6QludoTsGUhv9yEmkCoEuC+AeHEKphYqJJvIS0xjEF1RaimQ7TPbmGC1TyBp8V4XhnECArIOwQHdabvsQNGzt6g=
before_install:
- openssl aes-256-cbc -K $encrypted_aafaeab20519_key -iv $encrypted_aafaeab20519_iv
  -in ./.travis/private.gpg.enc -out ./.travis/private.gpg -d
- sudo rm /usr/local/bin/docker-compose
- curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname
  -s`-`uname -m` > docker-compose
- chmod +x docker-compose
- sudo mv docker-compose /usr/local/bin
install: cd $TEST_DIR && mvn install -Dmaven.test.skip=true
script: "/usr/local/bin/docker-compose -f ../docker-compose.yml up -d && mvn test"
after_script: "../deploy.sh"
cache:
  directories:
  - "$HOME/.m2"
